"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2303],{7691:(T,E,l)=>{l.d(E,{i7:()=>b,LK:()=>m,ru:()=>p});var u=l(7464),d=l(467),p=function(h){return h.Prompt="PROMPT",h.Camera="CAMERA",h.Photos="PHOTOS",h}(p||{}),v=function(h){return h.Rear="REAR",h.Front="FRONT",h}(v||{}),m=function(h){return h.Uri="uri",h.Base64="base64",h.DataUrl="dataUrl",h}(m||{});class g extends u.E_{getPhoto(r){var c=this;return(0,d.A)(function*(){return new Promise(function(){var a=(0,d.A)(function*(i,s){if(r.webUseInput||r.source===p.Photos)c.fileInputExperience(r,i,s);else if(r.source===p.Prompt){let e=document.querySelector("pwa-action-sheet");e||(e=document.createElement("pwa-action-sheet"),document.body.appendChild(e)),e.header=r.promptLabelHeader||"Photo",e.cancelable=!1,e.options=[{title:r.promptLabelPhoto||"From Photos"},{title:r.promptLabelPicture||"Take Picture"}],e.addEventListener("onSelection",function(){var t=(0,d.A)(function*(n){0===n.detail?c.fileInputExperience(r,i,s):c.cameraExperience(r,i,s)});return function(n){return t.apply(this,arguments)}}())}else c.cameraExperience(r,i,s)});return function(i,s){return a.apply(this,arguments)}}())})()}pickImages(r){var c=this;return(0,d.A)(function*(){return new Promise(function(){var a=(0,d.A)(function*(i,s){c.multipleFileInputExperience(i,s)});return function(i,s){return a.apply(this,arguments)}}())})()}cameraExperience(r,c,a){var i=this;return(0,d.A)(function*(){if(customElements.get("pwa-camera-modal")){const s=document.createElement("pwa-camera-modal");s.facingMode=r.direction===v.Front?"user":"environment",document.body.appendChild(s);try{yield s.componentOnReady(),s.addEventListener("onPhoto",function(){var e=(0,d.A)(function*(t){const n=t.detail;null===n?a(new u.I9("User cancelled photos app")):n instanceof Error?a(n):c(yield i._getCameraPhoto(n,r)),s.dismiss(),document.body.removeChild(s)});return function(t){return e.apply(this,arguments)}}()),s.present()}catch{i.fileInputExperience(r,c,a)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),i.fileInputExperience(r,c,a)})()}fileInputExperience(r,c,a){let i=document.querySelector("#_capacitor-camera-input");const s=()=>{var e;null===(e=i.parentNode)||void 0===e||e.removeChild(i)};i||(i=document.createElement("input"),i.id="_capacitor-camera-input",i.type="file",i.hidden=!0,document.body.appendChild(i),i.addEventListener("change",e=>{const t=i.files[0];let n="jpeg";if("image/png"===t.type?n="png":"image/gif"===t.type&&(n="gif"),"dataUrl"===r.resultType||"base64"===r.resultType){const o=new FileReader;o.addEventListener("load",()=>{if("dataUrl"===r.resultType)c({dataUrl:o.result,format:n});else if("base64"===r.resultType){const f=o.result.split(",")[1];c({base64String:f,format:n})}s()}),o.readAsDataURL(t)}else c({webPath:URL.createObjectURL(t),format:n}),s()}),i.addEventListener("cancel",e=>{a(new u.I9("User cancelled photos app")),s()})),i.accept="image/*",i.capture=!0,r.source===p.Photos||r.source===p.Prompt?i.removeAttribute("capture"):r.direction===v.Front?i.capture="user":r.direction===v.Rear&&(i.capture="environment"),i.click()}multipleFileInputExperience(r,c){let a=document.querySelector("#_capacitor-camera-input-multiple");const i=()=>{var s;null===(s=a.parentNode)||void 0===s||s.removeChild(a)};a||(a=document.createElement("input"),a.id="_capacitor-camera-input-multiple",a.type="file",a.hidden=!0,a.multiple=!0,document.body.appendChild(a),a.addEventListener("change",s=>{const e=[];for(let t=0;t<a.files.length;t++){const n=a.files[t];let o="jpeg";"image/png"===n.type?o="png":"image/gif"===n.type&&(o="gif"),e.push({webPath:URL.createObjectURL(n),format:o})}r({photos:e}),i()}),a.addEventListener("cancel",s=>{c(new u.I9("User cancelled photos app")),i()})),a.accept="image/*",a.click()}_getCameraPhoto(r,c){return new Promise((a,i)=>{const s=new FileReader,e=r.type.split("/")[1];"uri"===c.resultType?a({webPath:URL.createObjectURL(r),format:e,saved:!1}):(s.readAsDataURL(r),s.onloadend=()=>{const t=s.result;a("dataUrl"===c.resultType?{dataUrl:t,format:e,saved:!1}:{base64String:t.split(",")[1],format:e,saved:!1})},s.onerror=t=>{i(t)})})}checkPermissions(){var r=this;return(0,d.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw r.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw r.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var r=this;return(0,d.A)(function*(){throw r.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var r=this;return(0,d.A)(function*(){throw r.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var r=this;return(0,d.A)(function*(){throw r.unavailable("Not implemented on web.")})()}}new g;const b=(0,u.F3)("Camera",{web:()=>new g})},1889:(T,E,l)=>{l.d(E,{Wi:()=>d,__:()=>u});var u=function(m){return m.Documents="DOCUMENTS",m.Data="DATA",m.Library="LIBRARY",m.Cache="CACHE",m.External="EXTERNAL",m.ExternalStorage="EXTERNAL_STORAGE",m}(u||{}),d=function(m){return m.UTF8="utf8",m.ASCII="ascii",m.UTF16="utf16",m}(d||{})},2303:(T,E,l)=>{l.d(E,{B:()=>c});var u=l(467),d=l(4412),p=l(7691),v=l(7464),m=l(1889);const g=(0,v.F3)("Filesystem",{web:()=>l.e(2937).then(l.bind(l,2937)).then(a=>new a.FilesystemWeb)});var y=l(3953),b=l(1932),h=l(3656),r=l(4742);let c=(()=>{var a;class i{constructor(e,t,n){this.sqlite=e,this.platform=t,this.toastController=n,this.tblServicio="\n    CREATE TABLE IF NOT EXISTS servicio (\n      id INTEGER PRIMARY KEY AUTOINCREMENT, \n      fecha TEXT, \n      hora TEXT, \n      motivo TEXT, \n      direccion TEXT, \n      imagenes TEXT, \n      nombre_dispositivo TEXT, \n      estado_servicio TEXT, \n      tipo_servicio TEXT, \n      cliente_id INTEGER\n    )",this.listaServicio=new d.t([]),this.isDbReady=new d.t(!1),this.crearBD()}crearBD(){return this.platform.ready().then(()=>this.sqlite.create({name:"servicio.db",location:"default"}).then(e=>(this.database=e,this.presentToast("BD creada"),this.crearTablas(),this.isDbReady.next(!0),e)).catch(e=>{throw this.presentToast("Error al crear BD"),new Error(e)}))}crearTablas(){this.database.executeSql(this.tblServicio,[]).then(()=>{this.presentToast("Tabla de servicio creada")}).catch(t=>this.presentToast("Error al crear la tabla"))}addServicio(e){var t=this;return(0,u.A)(function*(){const o=[e.fecha,e.hora,e.motivo,e.direccion,e.imagenes,e.nombre_dispositivo,e.estado_servicio,e.tipo_servicio,e.cliente_id];try{yield t.database.executeSql("\n      INSERT INTO servicio (\n        fecha, hora, motivo, direccion, imagenes, nombre_dispositivo, estado_servicio, tipo_servicio, cliente_id\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\n    ",o),t.presentToast("Servicio agregado exitosamente"),yield t.getServicio().then(f=>{t.listaServicio.next(f)})}catch(f){throw t.presentToast("Error al agregar servicio: "+f),f}})()}getServicio(){var e=this;return(0,u.A)(function*(){try{const n=yield e.database.executeSql("SELECT * FROM servicio",[]);let o=[];for(let f=0;f<n.rows.length;f++)o.push(n.rows.item(f));return o}catch(n){return e.presentToast("Error al obtener los servicios: "+n),[]}})()}getServicioId(e){var t=this;return(0,u.A)(function*(){try{const o=yield t.database.executeSql("SELECT * FROM servicio WHERE id = ?",[e]);return o.rows.length>0?o.rows.item(0):null}catch(o){return t.presentToast("Error al obtener servicio por ID: "+o),null}})()}eliminarServicio(e){var t=this;return(0,u.A)(function*(){try{yield t.database.executeSql("DELETE FROM servicio WHERE id = ?",[e]),t.presentToast("Servicio eliminado"),yield t.getServicio().then(o=>{t.listaServicio.next(o)})}catch(o){t.presentToast("Error al eliminar servicio: "+o)}})()}presentToast(e){var t=this;return(0,u.A)(function*(){(yield t.toastController.create({message:e,duration:2e3})).present()})()}dbReady(){return this.isDbReady.asObservable()}get dbState(){return this.isDbReady.asObservable()}seleccionarImagen(){var e=this;return(0,u.A)(function*(){try{var t;return null!==(t=(yield p.i7.getPhoto({quality:90,resultType:p.LK.Base64,source:p.ru.Prompt})).base64String)&&void 0!==t?t:null}catch{return e.presentToast("Error al seleccionar imagen"),null}})()}saveImageToFilesystem(e,t){var n=this;return(0,u.A)(function*(){try{return(yield g.writeFile({path:`images/${t}`,data:e,directory:m.__.Data})).uri}catch(o){throw n.presentToast("Error al guardar imagen"),o instanceof Error?new Error(o.message):new Error("Error desconocido")}})()}addServicioConImagen(e){var t=this;return(0,u.A)(function*(){const n=yield t.seleccionarImagen();let o="";n&&(o=yield t.saveImageToFilesystem(n,`servicio_${(new Date).getTime()}.jpg`)),e.imagenes=o,yield t.addServicio(e)})()}}return(a=i).\u0275fac=function(e){return new(e||a)(y.KVO(b.j),y.KVO(h.OD),y.KVO(r.K_))},a.\u0275prov=y.jDH({token:a,factory:a.\u0275fac,providedIn:"root"}),i})()}}]);